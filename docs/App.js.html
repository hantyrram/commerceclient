<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: App.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: App.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import axios from 'axios';
import {
  BrowserRouter as Router, 
  Redirect,
  Route,
  Switch} from 'react-router-dom';
import LoginPage from './pages/LoginPage';
import UserHome from './pages/UserHome';
import features from './features';
import {user_permissions_read as getUserPermissions} from './features/requesters';
import './App.css';

/**
 * Checks if the user has the given permission.Note: MUST bind user as this.
 * @param {string} permissionName 
 */
const hasPermission = function(permissionName){
  if(!this.permissions || this.permissions.length &lt; 1 )return false;
  return this.permissions.find(permission=>permission.name === permissionName);
}

class App extends Component {
  constructor(props){
    super(props);
    this.state = {
      user:null
    }
    this.onLogin = this.onLogin.bind(this);
    this.onLogout = this.onLogout.bind(this);
  }

  onLogin(user){//after successful login
    user.hasPermission = hasPermission.bind(user);
    this.setState({user:user});
    //replace with user.getOwnPermissions();
    getUserPermissions(this.state.user.username).then(response=>{
      let user = this.state.user;
      user.permissions = response.data.data.permissions;
      user.features = [];
      features.forEach(feature=>{
       let truthTable = user.permissions.map(permission=>{
        return feature.actions.includes(permission);
       });
       if(truthTable.includes(true)){//the feature can handle at least one of the permission
        //fetch the feature,add as a feature of user
        user.features.push(feature);
       }

      });
      this.setState({user:user});
    });
    
  }

  onLogout(result){
    if(result.status === 200 &amp;&amp; result.data.status === 'ok'){
      this.setState({user:null});
    }
    
  }

  onMessage(message){
   this.setState({message:message});
  }

  render() {
    const login = ()=>{return this.state.user?&lt;Redirect to="/" />:&lt;LoginPage onLogin={this.onLogin}/> }
    const userHome = (props)=>{return this.state.user?&lt;UserHome {...props} user={this.state.user} onLogout={this.onLogout} onMessage={this.state.message}/>:&lt;Redirect to="/login"/>}
    const NOT_FOUND = ({history})=>{return(&lt;div>&lt;h1>Page Not Found&lt;/h1>&lt;/div>)}
    return (
     &lt;Router>
      &lt;Switch>
        &lt;Route path="/login" render={login} />
        &lt;Route path="/" render={userHome} />
      &lt;/Switch>
     &lt;/Router>
    );
  }
}

export default App;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Bread.html">Bread</a></li><li><a href="Entity.html">Entity</a></li><li><a href="EntityBrowser.html">EntityBrowser</a></li><li><a href="Permission.html">Permission</a></li><li><a href="PermissionBrowse.html">PermissionBrowse</a></li></ul><h3>Global</h3><ul><li><a href="global.html#EntityAddForm">EntityAddForm</a></li><li><a href="global.html#EntityReadForm">EntityReadForm</a></li><li><a href="global.html#EntityUpdateForm">EntityUpdateForm</a></li><li><a href="global.html#hasPermission">hasPermission</a></li><li><a href="global.html#subscribers">subscribers</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Mar 16 2019 03:30:06 GMT+0300 (Arabian Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
